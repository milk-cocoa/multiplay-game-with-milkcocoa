!function t(e,r,i){function n(s,a){if(!r[s]){if(!e[s]){var p="function"==typeof require&&require;if(!a&&p)return p(s,!0);if(o)return o(s,!0);var d=new Error("Cannot find module '"+s+"'");throw d.code="MODULE_NOT_FOUND",d}var l=r[s]={exports:{}};e[s][0].call(l.exports,function(t){var r=e[s][1][t];return n(r?r:t)},l,l.exports,t,e,r,i)}return r[s].exports}for(var o="function"==typeof require&&require,s=0;s<i.length;s++)n(i[s]);return n}({1:[function(t,e,r){function i(t){var e=this,r=new MilkCocoa(t);this.baseDS=r.dataStore("mlkccagame"),this.pingManager=new a(this.baseDS),this.onCreatedObjectHandler=null,this.masters={},this.replicas={},this.baseDS.on("set",function(t){e.register(t)})}function n(){for(var t=(new Date).getTime().toString(36),e=0;6>e;e++)t+=String.fromCharCode(97+(260*Math.random()<<0)%26);return t}var o=t("./master"),s=t("./replica"),a=t("./pingman");i.prototype.register=function(t){var e=this;if(!this.masters.hasOwnProperty(t.id))if(e.replicas.hasOwnProperty(t.id))e.replicas[t.id]._update(t.value);else{var r=new s(e.baseDS,t.id,t.value);e.replicas[r.getId()]=r,e.pingManager.setRepl(r),r.onDestroyHandler(function(){delete e.replicas[r.getId()]}),e.onCreatedObjectHandler&&e.onCreatedObjectHandler(r)}},i.prototype.init=function(){var t=this;this.baseDS.stream().sort("desc").size(10).next(function(e,r){r.forEach(function(e){t.register(e),t.masters.hasOwnProperty(e.id)&&t.masters[e.id]._update(e.value)})})},i.prototype.createObject=function(t){var e=localStorage.getItem("mlkccagame.masterid");e||(e=n(),localStorage.setItem("mlkccagame.masterid",e)),this.replicas.hasOwnProperty(e)&&(t=this.replicas[e].getParams(),this.replicas[e].destroy(),delete this.replicas[e]),this.pingManager.setId(e);var r=new o(this.baseDS,e,t);return this.masters[r.getId()]=r,r},i.prototype.onCreatedObject=function(t){this.onCreatedObjectHandler=t},i.prototype.getNumOfRepls=function(){var t=0;for(var e in replicas)t++;return t},window.MultiPlayerGame=i},{"./master":2,"./pingman":3,"./replica":4}],2:[function(t,e,r){function i(t,e,r){this.id=e,this.params=r,this.onUpdateHandler=null,this.baseDS=t,console.log(this.baseDS),this.baseDS.set(this.id,this.params)}i.prototype.getId=function(){return this.id},i.prototype.getParams=function(){return this.params},i.prototype._update=function(t){for(var e in t)this.params[e]=t[e];this.onUpdateHandler&&this.onUpdateHandler(this.params)},i.prototype.update=function(t){for(var e in t)this.params[e]=t[e];this.baseDS.set(this.id,t)},i.prototype.onUpdate=function(t){this.onUpdateHandler=t},e.exports=i},{}],3:[function(t,e,r){function i(t,e){var r=this;this.id=null,this.option=e||{},this.option.ping_interval=this.option.ping_interval||12e3,this.handlers={},this.replIds={};var i=t.child("ping");i.on("send",function(t){r.replIds[t.value.id]&&r.replIds[t.value.id].recvPing()}),setInterval(function(){null!=r.id&&i.send({id:r.id})},this.option.ping_interval)}i.prototype.setId=function(t){this.id=t},i.prototype.setRepl=function(t){this.replIds[t.getId()]=t},e.exports=i},{}],4:[function(t,e,r){function i(t,e,r){var i=this;this.id=e,this.params=r,this.onUpdateHandler=null,this.onDestroyHandlers=[],this.alive=!0,this.timer=setTimeout(function(){i.alive=!1,i.fireOnDestroyHandlers()},26e3)}i.prototype.getId=function(){return this.id},i.prototype.getParams=function(){return this.params},i.prototype.isAlive=function(){return this.alive},i.prototype._update=function(t){this.onUpdateHandler&&this.onUpdateHandler(t)},i.prototype.onUpdate=function(t){this.onUpdateHandler=t},i.prototype.destroy=function(){this.alive=!1,this.fireOnDestroyHandlers()},i.prototype.onDestroyHandler=function(t){this.onDestroyHandlers.push(t)},i.prototype.fireOnDestroyHandlers=function(){this.onDestroyHandlers.forEach(function(t){t()})},i.prototype.recvPing=function(){var t=this;clearTimeout(this.timer),this.timer=setTimeout(function(){t.destroy()},26e3)},e.exports=i},{}]},{},[1]);